<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Python-HTML image viewer client</title>

    <script type="text/javascript">
      (function startSocket() {
        let webSocket = new WebSocket("ws://localhost:9998");

        webSocket.onopen = () =>
          (document.body.style.backgroundImage = "url(ready.png)");

        webSocket.onmessage = (message) => {
          // `message.data` is dataURI
          document.body.style.backgroundImage = "url(" + message.data + ")";
          webSocket.send("rendered");
        };

        webSocket.onclose = () => {
          document.body.style.backgroundImage = "url(disconnected.png)";

          // Attempt to reconnect every 5 seconds.
          setTimeout(startSocket, 5000);
        };

        window.onbeforeunload = () => {
          // Disabling onclose handler first.
          webSocket.onclose = function () {};
          webSocket.close(1000, "Window unloaded.");
        };
      })();
    </script>

    <style type="text/css">
      body {
        background-color: #000000;
        background-image: url("disconnected.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center center;
      }
    </style>
  </head>
</html>
